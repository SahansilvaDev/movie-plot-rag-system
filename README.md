# Mini RAG System for Movie Plots

A lightweight Retrieval-Augmented Generation (RAG) system that answers questions about movie plots using the Wikipedia Movie Plots dataset.

**notebook** `movie_plot_rag.ipynb`. The notebook contains a complete, self-contained implementation of a mini Retrieval-Augmented Generation (RAG) system for querying movie plots from the `wiki_movie_plots_deduped.csv` dataset.

---

**What this notebook provides**
- A step-by-step RAG pipeline implemented in a single notebook: data loading -> chunking -> embedding -> FAISS vector store -> retrieval -> LLM generation.
- Interactive example queries and cells can edit and run.
- Structured JSON output for each query with `answer`, `contexts`, and `reasoning` fields.
- Documentation and suggested experiments (chunk size, top-k, number of movies).

---

**Quick summary of notebook sections (run in order)**
- 1. Install Dependencies — Installs required Python packages.
- 2. API Key Setup — Set `OPENAI_API_KEY` environment variable.
- 3. Import Libraries — Imports required Python modules.
- 4. MovieRAG Class — Full class implementation (data loading, chunking, embedding, retrieval, generation).
- 5. Initialize System — Create `MovieRAG()` instance.
- 6. Load Data — Loads 500 movies from `wiki_movie_plots_deduped.csv`.
- 7. Create Chunks — Splits plots into 300-word chunks.
- 8. Build Vector Store — Generates embeddings and creates FAISS index.
- 9. Example Queries — Several example queries run against the system.
- 10. Analysis & Retrieval Quality — Inspect outputs, retrieved contexts, and system statistics.

Note: The notebook is arranged so can run cells sequentially. 

---

**Prerequisites**
- Python 3.8+
- The project files in the same folder as the notebook, in particular:
  - `movie_plot_rag.ipynb`
  - `wiki_movie_plots_deduped.csv`
- An OpenAI API key for embeddings and generation.

---

**Install dependencies**

Run the install cell inside the notebook (it runs `pip install openai pandas numpy faiss-cpu python-dotenv`).

---

**Set OpenAI API key**
Set the `OPENAI_API_KEY` environment variable before running embedding/generation cells.

PowerShell (temporary for session):

```powershell
$env:OPENAI_API_KEY = "actual-key"
```

---

**Run the notebook**
1. Start Jupyter Notebook open the notebook in VS Code.
2. Open `movie_plot_rag.ipynb`.
3. Run cells from top to bottom (or click "Run All").

Commands to open the notebook from the project folder (PowerShell):

```powershell
# Start Jupyter Lab
jupyter lab

# OR start Jupyter Notebook
jupyter notebook
```

Or open the file directly in VS Code.

---

**Runtime expectations**
- Data loading and chunking: fast (seconds).
- Embedding generation and FAISS index building: can take 30–60s or more depending on rate limits and the number of chunks — this is the most time-consuming step.
- Query time: typically a few seconds (embedding + retrieval + generation).

**Approximate costs**
- Embeddings and LLM calls are performed via OpenAI — small cost per run (see notebook for a rough cost estimate included in the summary section).

---

**Output format**
Each query returns a JSON object with
- `answer` — Natural language answer generated by the LLM.
- `contexts` — Array of retrieved plot snippets (movie title + excerpt).
- `reasoning` — Short explanation of how the answer was formed (which contexts were used).

Example:

```json
{
  "answer": "The movie *2001: A Space Odyssey* features an AI called HAL 9000.",
  "contexts": ["2001: A Space Odyssey (1968): ... HAL 9000 becomes antagonistic ..."],
  "reasoning": "Searched plots for AI references and found HAL 9000 in '2001'."
}
```

---

**Troubleshooting**
- If see `OpenAI API key is required`, ensure `OPENAI_API_KEY` is set in environment or the notebook cell.
- If `faiss` import fails, install `faiss-cpu` with `pip install faiss-cpu` or check Python environment compatibility.
- If embedding generation is very slow, check for API rate limits or network issues. And can reduce `num_rows` in the data-loading cell to speed up testing.



---

**Where to look in the notebook**
Run the notebook top-to-bottom. The notebook includes clear headings and explanations above each major code section (data load, chunking, build index, queries). If want to quickly test, run these cells in order

- API key cell — set key.
- Import libraries cell.
- MovieRAG class cell.
- Initialize `MovieRAG()` cell.
- Load data cell (adjust `num_rows` if want fewer movies).
- Create chunks cell.
- Build vector store cell (this triggers embeddings).
- Example query cells.

---

SahansilvaDev - Enjoy exploring the notebook — it contains the full RAG pipeline and is ready to run once API key and dependencies are set.


Developed by @SahansilvaDev